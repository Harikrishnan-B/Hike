


<style>
  body {
	background: #eee;
	margin: 0;
	padding: 0;
	overflow-x: hidden;
}

.clearfix {
  content: "";
  display: table;
  clear: both;	
}

#site-header, #site-footer {
	background: #fff;
}

#site-header {
	margin: 0 0 30px 0;
}

#site-header h1 {
	font-size: 31px;
	font-weight: 300;
	padding: 40px 0;
	position: relative;
	margin: 0;
}

a {
	color: #000;
	text-decoration: none;

	-webkit-transition: color .2s linear;
	-moz-transition: color .2s linear;
	-ms-transition: color .2s linear;
	-o-transition: color .2s linear;
	transition: color .2s linear;
}

a:hover {
	color: #53b5aa;
}

#site-header h1 span {
	color: #53b5aa;
}

#site-header h1 span.last-span {
	background: #fff;
	padding-right: 150px;
	position: absolute;
	left: 217px;

	-webkit-transition: all .2s linear;
	-moz-transition: all .2s linear;
	-ms-transition: all .2s linear;
	-o-transition: all .2s linear;
	transition: all .2s linear;
}

#site-header h1:hover span.last-span, #site-header h1 span.is-open {
	left: 363px;
}

#site-header h1 em {
	font-size: 16px;
	font-style: normal;
	vertical-align: middle;
}

.container {
	font-family: 'Open Sans', sans-serif;
	margin: 0 auto;
	width: 980px;
}

#cart {
	width: 100%;
}

#cart h1 {
	font-weight: 300;
}

#cart a {
	color: #53b5aa;
	text-decoration: none;

	-webkit-transition: color .2s linear;
	-moz-transition: color .2s linear;
	-ms-transition: color .2s linear;
	-o-transition: color .2s linear;
	transition: color .2s linear;
}

#cart a:hover {
	color: #000;
}

.product.removed {
	margin-left: 980px !important;
	opacity: 0;
}

.product {
	border: 1px solid #eee;
	margin: 20px 0;
	width: 100%;
	height: 195px;
	position: relative;

	-webkit-transition: margin .2s linear, opacity .2s linear;
	-moz-transition: margin .2s linear, opacity .2s linear;
	-ms-transition: margin .2s linear, opacity .2s linear;
	-o-transition: margin .2s linear, opacity .2s linear;
	transition: margin .2s linear, opacity .2s linear;
}

.product img {
	width: 100%;
	height: 100%;
}

.product header, .product .content {
	background-color: #fff;
	border: 1px solid #ccc;
	border-style: none none solid none;
	float: left;
}

.product header {
	background: #000;
	margin: 0 1% 20px 0;
	overflow: hidden;
	padding: 0;
	position: relative;
	width: 24%;
	height: 195px;
}

.product header:hover img {
	opacity: .7;
}

.product header:hover h3 {
	bottom: 73px;
}

.product header h3 {
	background: #53b5aa;
	color: #fff;
	font-size: 22px;
	font-weight: 300;
	line-height: 49px;
	margin: 0;
	padding: 0 30px;
	position: absolute;
	bottom: -50px;
	right: 0;
	left: 0;

	-webkit-transition: bottom .2s linear;
	-moz-transition: bottom .2s linear;
	-ms-transition: bottom .2s linear;
	-o-transition: bottom .2s linear;
	transition: bottom .2s linear;
}

.remove {
	cursor: pointer;
}

.product .content {
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	height: 140px;
	padding: 0 20px;
	width: 75%;
}

.product h1 {
	color: #53b5aa;
	font-size: 25px;
	font-weight: 300;
	margin: 17px 0 20px 0;
}

.product footer.content {
	height: 50px;
	margin: 6px 0 0 0;
	padding: 0;
}

.product footer .price {
	background: #fcfcfc;
	color: #000;
	float: right;
	font-size: 15px;
	font-weight: 300;
	line-height: 49px;
	margin: 0;
	padding: 0 30px;
}

.product footer .full-price {
	background: #53b5aa;
	color: #fff;
	float: right;
	font-size: 22px;
	font-weight: 300;
	line-height: 49px;
	margin: 0;
	padding: 0 30px;

	-webkit-transition: margin .15s linear;
	-moz-transition: margin .15s linear;
	-ms-transition: margin .15s linear;
	-o-transition: margin .15s linear;
	transition: margin .15s linear;
}

.qt, .qt-plus, .qt-minus {
	display: block;
	float: left;
}

.qt {
	font-size: 19px;
	line-height: 50px;
	width: 70px;
	text-align: center;
}

.qt-plus, .qt-minus {
	background: #fcfcfc;
	border: none;
	font-size: 30px;
	font-weight: 300;
	height: 100%;
	padding: 0 20px;
	-webkit-transition: background .2s linear;
	-moz-transition: background .2s linear;
	-ms-transition: background .2s linear;
	-o-transition: background .2s linear;
	transition: background .2s linear;
}

.qt-plus:hover, .qt-minus:hover {
	background: #53b5aa;
	color: #fff;
	cursor: pointer;
}

.qt-plus {
	line-height: 50px;
}

.qt-minus {
	line-height: 47px;
}

#site-footer {
	margin: 30px 0 0 0;
}

#site-footer {
	padding: 40px;
}

#site-footer h1 {
	background: #fcfcfc;
	border: 1px solid #ccc;
	border-style: none none solid none;
	font-size: 24px;
	font-weight: 300;
	margin: 0 0 7px 0;
	padding: 14px 40px;
	text-align: center;
}

#site-footer h2 {
	font-size: 24px;
	font-weight: 300;
	margin: 10px 0 0 0;
}

#site-footer h3 {
	font-size: 19px;
	font-weight: 300;
	margin: 15px 0;
}

.left {
	float: left;
}

.right {
	float: right;
}

.btn {
	background: #53b5aa;
	border: 1px solid #999;
	border-style: none none solid none;
	cursor: pointer;
	display: block;
	color: #fff;
	font-size: 20px;
	font-weight: 300;
	padding: 16px 0;
	width: 290px;
	text-align: center;

	-webkit-transition: all .2s linear;
	-moz-transition: all .2s linear;
	-ms-transition: all .2s linear;
	-o-transition: all .2s linear;
	transition: all .2s linear;
}

.btn:hover {
	color: #fff;
	background: #429188;
}

.type {
	background: #fcfcfc;
	font-size: 13px;
	padding: 10px 16px;
	left: 100%;
}

.type, .color {
	border: 1px solid #ccc;
	border-style: none none solid none;
	position: absolute;
}

.color {
	width: 40px;
	height: 40px;
	right: -40px;
}

.red {
	background: #cb5a5e;
}

.yellow {
	background: #f1c40f;
}

.blue {
	background: #3598dc;
}

.minused {
	margin: 0 50px 0 0 !important;
}

.added {
	margin: 0 -50px 0 0 !important;
}

.container {
  text-align: center; /* Center align text within the container */
}

#site-header {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 90px; /* Adjust the height of the header */
  background-color: rgb(255, 255, 255); /* Add background color */
}


.image-container {
  position: relative;
  width: 205vh;
  height: 660px;
}

.image-container img {
  width: 100%;
  height: 100%;
}

.continue-shopping {
	position: absolute;
    bottom: 68px;
    left: 50%;
	border-radius: 10px;
    transform: translateX(-50%);
    font-size: 24px;
    color: white;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    z-index: 1;
	background-color: rgb(94, 138, 196);
    height: 45px;
    width: 200px;
    padding-top: 8px;
	cursor: pointer;

}


</style>


<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
</head>

<header id="site-header">
		  <!-- <button id="empty-home" style="margin-left: 740px;" onclick="window.location.href = '/home';">Go to Home</button> -->
		 
	<div class="container">
	  <!-- <img src="/images/cover.png" "> -->
	  <a href="/home"><img src="/images/Screenshot (58).png" style="height: 80px; width: 125px; margin-top: 15px; border-radius: 50% ;" ></a>
	  <!-- <h1>hike</h1> -->

	</div>
	
  </header>
  <!-- <img src="/images/cart-page icon.webp" style="height: 60px; width: 60px; margin-left: 100px;" alt=""> -->

  <div class="my-orders-header" style="margin-left: 50px; display: flex; align-items: center;">
	<img src="/images/cart-page icon.webp" style="height: 60px; width: 60px;" alt="My Orders Icon">
	<h1 style="margin-left: 10px;">Cart ðŸ¢‚</h1> <!-- Adjust margin-left to add space between image and text -->
  </div>
  

<% if(cart.items.length == 0) {%> 
	<div class="image-container">
    <img src="/images/Empty Cart.png" alt="Empty Cart">
    <div class="continue-shopping" onclick="window.location.href = '/home';">Continue Shopping</div>
  </div>
	// <!-- <button id="empty-home" style="margin-left: 740px;" onclick="window.location.href = '/home';">Go to Home</button> -->
<% }else{ %>
	<div class="container">
		<% cart.items.forEach((product, index) => { %>
		<section id="cart"> 
		  <article class="product" id="product_<%= product._id %>">
			<header>
			  <a class="remove" data-product-id="<%= product._id %>">
				<img src="<%=product.product.product_images[0] %>" style="max-width: 100%; height: 250px;" class="card-img-top" alt="...">
				<h3>Remove product</h3>
			  </a>
			</header>	  
			<div class="content">
			  <h1><%= product.product.name %></h1>	  
			  <%= product.product.description %>	  
			</div>
				<footer class="content" >
					<button class="qt-minus"   onclick="updateQuantity('<%= product.product._id %>', -1)">-</button>
					<span class="qt" id="quantity_<%= product.product._id %>"><%= product.quantity %></span> 
					<button class="qt-plus" onclick="updateQuantity('<%= product.product._id %>', 1)">+</button>                     
					<h2 class="full-price">
					  <h2 class="price" id="price_<%= product.product._id %>">â‚¹<%= product.product.price * product.quantity %></h2>           
					</h2>
				  </footer>
			
		  </article>
		</section>
		<% }); %>
	  </div>
	  
	  <footer id="site-footer">
		<div class="container clearfix">
		  <div class="right">
			<h1 class="total" id="totalPrice">Total : â‚¹<%= cart.TotalPrice %></h1>
			<a href="/checkout" class="btn">Checkout</a>
		  </div>
		</div>
	  </footer>
	  <% } %>
	  <%- include('footer') %>
	  
	  <script>
		async function updateQuantity(productId, quantity) {
			const quantityElement = document.getElementById(`quantity_${productId}`).textContent;
			console.log(quantity);
			console.log(quantityElement);
			if(parseInt(quantityElement)==1&&quantity==-1){
				return
			}
			if(parseInt(quantityElement)==10&&quantity==1){
				return
			}
            

		  try {
			const response = await fetch(`/addcart/${productId}`, {
			  method: 'POST', 
			  headers: {
				'Content-Type': 'application/json'
			  },
			  body: JSON.stringify({ quantity })
			});
			
			if (!response.ok) {
			  throw new Error('Failed to update quantity');
			}
	  
			const data = await response.json();

			if(data.error){
				return
			}
	  
			// Update quantity and price on the page
			const quantityElement = document.getElementById(`quantity_${productId}`);
			const priceElement = document.getElementById(`price_${productId}`);
	  
			quantityElement.textContent = data.updatedProduct.quantity;
			priceElement.textContent = `â‚¹${data.updatedProduct.total}`;

			const totalPriceElement = document.getElementById('totalPrice');
         totalPriceElement.textContent = `Total : â‚¹${data.totalPrice}`;
			
		  } catch (error) {
			console.error('Error updating quantity:', error);
		  }
		}
	  </script>
	  
<!-- <script>
	var check = false;
	function changeVal(el) {
	  var qt = parseInt(el.parent().find(".qt").text()); 
	  var price = parseFloat(el.parent().siblings(".content").find(".price").text().slice(1)); 
	  var eq = qt * price; 
	  
	  // Update the total price displayed for this product
	  el.parent().siblings(".content").find(".full-price").text("â‚¹" + eq.toFixed(2));
	  
	  // Update the total price after changing the quantity
	  changeTotal();
  }
  
  function changeTotal() {
	  var totalPrice = 0; // Initialize total price
	  
	  // Loop through each product
	  $(".product").each(function(index) {
		  var qt = parseInt($(this).find(".qt").text()); // Get the quantity of the product
		  var price = parseFloat($(this).find(".price").text().slice(1)); // Get the price of the product and remove the currency symbol
		  var eq = qt * price; // Calculate total price for this product
		  
		  totalPrice += eq; // Add total price of this product to the total
	  });
	  
	  // Update the total price in the footer
	  $(".total span").text("â‚¹" + totalPrice.toFixed(2));
  }
  
  $(document).ready(function(){
	
	$(".remove").click(function(){
	  var el = $(this);
	  el.parent().parent().addClass("removed");
	  window.setTimeout(
		function(){
		  el.parent().parent().slideUp('fast', function() { 
			el.parent().parent().remove(); 
			if($(".product").length == 0) {
			  if(check) {
				$("#cart").html("<h1>The shop does not function, yet!</h1><p>If you liked my shopping cart, please take a second and heart this Pen on <a href='https://codepen.io/ziga-miklic/pen/xhpob'>CodePen</a>. Thank you!</p>");
			  } else {
				$("#cart").html("<h1>No products!</h1>");
			  }
			}
			changeTotal(); 
		  });
		}, 200);
	});
	
	$(".qt-plus").click(function(){
		  var quantityElement = $(this).siblings(".qt");
		  quantityElement.text(parseInt(quantityElement.text()) + 1); // Increase quantity by 1
		  changeVal($(this)); // Update total price
	  });
  
	
	  $(".qt-minus").click(function(){
		  var quantityElement = $(this).siblings(".qt");
		  if (parseInt(quantityElement.text()) > 1) {
			  quantityElement.text(parseInt(quantityElement.text()) - 1); // Decrease quantity by 1 if greater than 1
			  changeVal($(this)); // Update total price
		  }
	  });
	
	window.setTimeout(function(){$(".is-open").removeClass("is-open")}, 1200);
	
	$(".remove").click(function(){
		  $(this).closest(".product").remove(); // Remove the product from the DOM
		  changeTotal(); // Update total price
	  });
  });
  </script>
  -->
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
	$(document).ready(function(){
	  $(".remove").click(function(){
		var productId = $(this).data("product-id");
		
		$.post('/removeFromCart/' + productId, function(response) {
		  // Handle the response
		  if (response.success) {
			$("#product_" + productId).slideUp('fast', function() { 
			  $(this).remove(); 
			  if($(".product").length == 0) {
				// If there are no more products left, update the UI accordingly
			window.location.reload()
			  }
			  // Perform any additional UI updates
			  $('#totalPrice').text('Total : â‚¹' + response.totalPrice);
			});
		  } else {
			// Display an error message if removal failed
			alert('Failed to remove the product. Please try again later.');
		  }
		});
	  });
	});
  </script>
  
